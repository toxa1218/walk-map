<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
        .join-btn {
            background-color: #0088cc; color: white; border: none;
            padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;
            width: 100%; margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand(); // –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL (–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞–ª –±–æ—Ç)
        const urlParams = new URLSearchParams(window.location.search);
        const eventsData = JSON.parse(urlParams.get('data') || '[]');

        var map = L.map('map').setView([50.45, 30.52], 12); // –¶–µ–Ω—Ç—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ö–∏–µ–≤)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
        eventsData.forEach(event => {
            let marker = L.marker([event.lat, event.lon]).addTo(map);
            
            // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ø–∞–ø–∞
            let popupContent = `
                <b>${event.desc}</b><br>
                ‚è∞ ${event.time}<br>
                üè∑ ${event.tags}<br>
                <button class="join-btn" onclick="sendJoin(${event.id})">–ü–æ–π—Ç–∏</button>
            `;
            marker.bindPopup(popupContent);
        });

        // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò
        function sendJoin(eventId) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º JSON –æ–±—ä–µ–∫—Ç
            let data = JSON.stringify({
                action: "join",
                id: eventId
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            function sendJoin(eventId) {
    // –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_BOT_USERNAME –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —é–∑–µ—Ä–Ω–µ–π–º –±–æ—Ç–∞ –±–µ–∑ @
    const botUsername = "MySuperWalkerBot"; 
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
    window.location.href = `https://t.me/${botUsername}?start=join_${eventId}`;
} 
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ (–∏–Ω–æ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç, —Ö–æ—Ç—è sendData –¥–æ–ª–∂–µ–Ω —Å–∞–º –∑–∞–∫—Ä—ã–≤–∞—Ç—å)
            // tg.close(); 
        }
    </script>
</body>
</html>

